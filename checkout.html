<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParkNGo Checkout</title>
    <style>
      body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; margin: 0; background: #f8fafc; color: #0f172a; text-align: center; }
      .btn { display: none; margin-top: 20px; padding: 12px 24px; background: #2f80ed; color: white; border-radius: 12px; text-decoration: none; font-weight: bold; }
    </style>
  </head>
  <body>
    <div id="status">Initiating Secure Payment...</div>
    <a id="fallback-btn" class="btn">Return to App Manually</a>

    <script src="https://checkout.razorpay.com/v1/checkout.js"></script>
    <script>
      const params = new URLSearchParams(window.location.search);
      const appScheme = params.get("appScheme") || "parkngo://";
      
      const options = {
        "key": params.get("keyId"),
        "amount": params.get("amount"),
        "currency": "INR",
        "name": "ParkNGo",
        "description": "Parking Reservation",
        "order_id": params.get("orderId"),
        "handler": function (response) {
    // 1. Get the scheme and ensure it's not null
    let scheme = params.get("appScheme") || "parkngo://";
    
    // 2. Build the exact success URL
    const successUrl = `${scheme}payment-callback?` + 
                       `razorpay_payment_id=${response.razorpay_payment_id}` + 
                       `&razorpay_order_id=${response.razorpay_order_id}` + 
                       `&razorpay_signature=${response.razorpay_signature}`;

    // 3. Force the redirect
    window.location.href = successUrl;
    
    // 4. Fallback for Android Chrome
    setTimeout(() => { window.location.replace(successUrl); }, 500);
},
        "modal": {
            "ondismiss": function() {
                window.location.href = appScheme + "payment-callback?status=cancelled";
            }
        },
        "theme": { "color": "#2F80ED" }
      };

      const rzp = new Razorpay(options);
      
      // Auto-open the payment modal on load
      window.onload = function() {
        rzp.open();
      };
    </script>
  </body>
</html>